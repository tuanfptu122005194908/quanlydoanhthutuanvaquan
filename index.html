<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω Doanh Thu</title>
    <style>
      /* ============ VARIABLES ============ */
      :root {
        /* Gradients - Modern & Vibrant */
        --primary-gradient: linear-gradient(
          135deg,
          #6366f1 0%,
          #8b5cf6 50%,
          #d946ef 100%
        );
        --secondary-gradient: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
        --success-gradient: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
        --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
        --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        --dark-gradient: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        --accent-gradient: linear-gradient(135deg, #ec4899 0%, #f97316 100%);

        /* Solid Colors */
        --primary-color: #6366f1;
        --primary-dark: #4f46e5;
        --primary-light: #818cf8;
        --success-color: #10b981;
        --danger-color: #ef4444;
        --warning-color: #f59e0b;
        --info-color: #06b6d4;

        /* Backgrounds */
        --bg-light: #f8fafc;
        --bg-white: #ffffff;
        --bg-card: #ffffff;
        --text-dark: #0f172a;
        --text-gray: #64748b;
        --text-light: #94a3b8;
        --border-color: #e2e8f0;

        /* Shadows with color */
        --shadow-primary: 0 4px 20px rgba(99, 102, 241, 0.15);
        --shadow-success: 0 4px 20px rgba(16, 185, 129, 0.15);
        --shadow-warning: 0 4px 20px rgba(245, 158, 11, 0.15);
        --shadow-danger: 0 4px 20px rgba(239, 68, 68, 0.15);
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.15);

        /* Border Radius */
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
        --radius-2xl: 24px;

        /* Transitions */
        --transition-fast: 0.15s ease;
        --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      [data-theme="dark"] {
        --bg-light: #0f172a;
        --bg-white: #1e293b;
        --bg-card: #1e293b;
        --text-dark: #f1f5f9;
        --text-gray: #94a3b8;
        --text-light: #cbd5e1;
        --border-color: #334155;
        --shadow-primary: 0 4px 20px rgba(99, 102, 241, 0.25);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 10px 30px rgba(0, 0, 0, 0.5);
        --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.6);
      }

      /* ============ RESET & BASE ============ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: var(--bg-light);
        color: var(--text-dark);
        line-height: 1.6;
        transition: background-color var(--transition-base),
          color var(--transition-base);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ============ HEADER ============ */
      .header {
        background: var(--bg-white);
        box-shadow: var(--shadow-md);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(20px) saturate(180%);
        border-bottom: 1px solid var(--border-color);
        animation: slideDown 0.5s ease;
      }

      @keyframes slideDown {
        from {
          transform: translateY(-100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .header-content {
        /* TƒÇNG MAX WIDTH CHO M√ÄN H√åNH L·ªöN */
        max-width: 1800px;
        margin: 0 auto;
        padding: 1.25rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .header h1 {
        font-size: 1.75rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 800;
        letter-spacing: -0.5px;
        animation: fadeInLeft 0.6s ease;
      }

      @keyframes fadeInLeft {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .header-actions {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        animation: fadeInRight 0.6s ease;
      }

      @keyframes fadeInRight {
        from {
          opacity: 0;
          transform: translateX(20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      /* ============ NAVIGATION ============ */
      .nav {
        display: flex;
        gap: 0.5rem;
        background: var(--bg-light);
        padding: 0.5rem;
        border-radius: var(--radius-lg);
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      .nav-btn {
        padding: 0.65rem 1.25rem;
        border: none;
        background: transparent;
        color: var(--text-gray);
        cursor: pointer;
        border-radius: var(--radius-md);
        font-weight: 600;
        font-size: 0.9rem;
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
      }

      .nav-btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: var(--primary-gradient);
        transform: translate(-50%, -50%);
        transition: width var(--transition-slow), height var(--transition-slow);
        z-index: -1;
      }

      .nav-btn:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-primary);
      }

      .nav-btn:hover::before {
        width: 200%;
        height: 200%;
        border-radius: var(--radius-md);
      }

      .nav-btn.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: var(--shadow-primary);
        transform: translateY(-2px);
      }

      .nav-btn:active {
        transform: translateY(0) scale(0.98);
      }

      /* ============ DARK MODE TOGGLE ============ */
      .theme-toggle {
        background: var(--primary-gradient);
        border: none;
        padding: 0.65rem;
        border-radius: var(--radius-md);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 45px;
        height: 45px;
        transition: all var(--transition-base);
        box-shadow: var(--shadow-primary);
        color: white;
        position: relative;
        overflow: hidden;
      }

      .theme-toggle::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.6s;
      }

      .theme-toggle:hover {
        transform: rotate(180deg) scale(1.05);
        box-shadow: var(--shadow-lg);
      }

      .theme-toggle:hover::before {
        transform: translateX(100%);
      }

      .theme-toggle:active {
        transform: rotate(180deg) scale(0.95);
      }

      /* ============ CONTAINER ============ */
      .container {
        /* TƒÇNG MAX WIDTH CHO M√ÄN H√åNH L·ªöN */
        max-width: 1800px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }

      .section {
        display: none;
        animation: fadeInUp 0.5s ease;
      }

      .section.active {
        display: block;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* ============ DASHBOARD STATS ============ */
      .stats-grid {
        display: grid;
        /* Gi·ªØ 4 c·ªôt cho m√†n h√¨nh desktop th√¥ng th∆∞·ªùng */
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .stat-card {
        background: var(--bg-card);
        padding: 2rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
        border: 1px solid var(--border-color);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        transition: height var(--transition-base);
      }

      .stat-card::after {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(99, 102, 241, 0.05) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: opacity var(--transition-base);
      }

      .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: var(--shadow-xl);
        border-color: transparent;
      }

      .stat-card:hover::before {
        height: 100%;
        opacity: 0.05;
      }

      .stat-card:hover::after {
        opacity: 1;
      }

      .stat-card:nth-child(1)::before {
        background: var(--primary-gradient);
      }

      .stat-card:nth-child(2)::before {
        background: var(--success-gradient);
      }

      .stat-card:nth-child(3)::before {
        background: var(--warning-gradient);
      }

      .stat-card:nth-child(4)::before {
        background: var(--accent-gradient);
      }

      .stat-label {
        color: var(--text-gray);
        font-size: 0.875rem;
        margin-bottom: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        position: relative;
        z-index: 1;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 800;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
        animation: countUp 0.8s ease;
      }

      @keyframes countUp {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .stat-card:nth-child(2) .stat-value {
        background: var(--success-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-card:nth-child(3) .stat-value {
        background: var(--warning-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-card:nth-child(4) .stat-value {
        background: var(--accent-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .stat-change {
        font-size: 0.875rem;
        margin-top: 0.5rem;
        color: var(--success-color);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.25rem;
        position: relative;
        z-index: 1;
      }

      /* ============ CHART ============ */
      .chart-container {
        background: var(--bg-card);
        padding: 2rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        transition: all var(--transition-base);
        border: 1px solid var(--border-color);
        position: relative;
        overflow: hidden;
      }

      /* Th√™m Animation Glow v√† V√πng m√†u n·ªÅn l·∫•p l√°nh */
      .chart-container {
        /* M·∫∑c ƒë·ªãnh cho hi·ªáu ·ª©ng glow */
        box-shadow: 0 0 10px rgba(99, 102, 241, 0.2);
        animation: neon-glow 3s ease-in-out infinite alternate; /* √Åp d·ª•ng hi·ªáu ·ª©ng glow */
      }

      @keyframes neon-glow {
        0% {
          box-shadow: 0 0 10px rgba(99, 102, 241, 0.4),
            0 0 20px rgba(99, 102, 241, 0.1);
        }
        100% {
          box-shadow: 0 0 25px rgba(99, 102, 241, 0.8),
            0 0 40px rgba(139, 92, 246, 0.4);
        }
      }

      .chart-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-gradient);
        /* Thay ƒë·ªïi: Bi·ªÉu ƒë·ªì ƒë·∫πp h∆°n s·∫Ω kh√¥ng c√≥ v·∫°ch ngang ƒë∆°n gi·∫£n, m√† c√≥ hi·ªáu ·ª©ng l·∫•p l√°nh */
        background: var(--accent-gradient); /* D√πng m√†u accent ƒë·ªÉ n·ªïi b·∫≠t h∆°n */
        box-shadow: 0 0 10px var(--primary-color);
        height: 5px; /* D√†y h∆°n m·ªôt ch√∫t */
        transition: all var(--transition-base);
      }

      .chart-container:hover {
        box-shadow: var(--shadow-xl); /* Shadow l·ªõn h∆°n khi hover */
        transform: translateY(-4px);
        border-color: var(--primary-color); /* N·ªïi b·∫≠t border khi hover */
      }

      .chart-container:hover::before {
        height: 10px;
        opacity: 0.8;
      }

      /* FIX: ƒê·ªãnh nghƒ©a chi·ªÅu cao cho canvas ƒë·ªÉ tr√°nh b·ªã k√©o d√†i */
      .chart-container canvas {
        max-height: 400px;
        height: 400px !important;
      }

      .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid var(--border-color);
      }

      @keyframes flow {
        0% {
          background-position: 0% 50%;
        }
        100% {
          background-position: 100% 50%;
        }
      }

      #chartPeriod {
        padding: 0.65rem 1.25rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 0.95rem;
        background: var(--bg-light);
        color: var(--text-dark);
        cursor: pointer;
        font-weight: 600;
        transition: all var(--transition-base);
      }

      /* Dark Mode Enhancements for Chart */
      [data-theme="dark"] .chart-container {
        background: linear-gradient(
          135deg,
          #101524 0%,
          #1a2233 100%
        ); /* N·ªÅn t·ªëi h∆°n */
        border-color: #334155;
      }
      [data-theme="dark"] .chart-header h3 {
        background: linear-gradient(90deg, #a78bfa, #c4b5fd, #f97316);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* ============ FORM ============ */
      .form-card {
        background: var(--bg-card);
        padding: 2rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        border: 1px solid var(--border-color);
        transition: all var(--transition-base);
        position: relative;
        overflow: hidden;
      }

      .form-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-gradient);
      }

      .form-card:hover {
        box-shadow: var(--shadow-lg);
      }

      .form-card h3 {
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.25rem;
        margin-bottom: 1.5rem;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.875rem;
        letter-spacing: 0.3px;
      }

      .form-group input,
      .form-group textarea {
        padding: 0.85rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 1rem;
        background: var(--bg-light);
        color: var(--text-dark);
        transition: all var(--transition-base);
        font-family: inherit;
        resize: vertical;
      }

      .form-group input:hover,
      .form-group textarea:hover {
        border-color: var(--primary-light);
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        transform: translateY(-2px);
        background: var(--bg-white);
      }

      /* New: Bulk Paste Styles */
      .bulk-paste-card {
        background: var(--bg-card);
        padding: 2rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        border: 1px solid var(--border-color);
        transition: all var(--transition-base);
      }

      .bulk-paste-card h3 {
        margin-bottom: 1rem;
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-dark);
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 0.5rem;
      }

      .bulk-paste-card textarea {
        min-height: 150px;
        margin-bottom: 1rem;
      }

      /* ============ BUTTONS ============ */
      .btn {
        padding: 0.85rem 1.75rem;
        border: none;
        border-radius: var(--radius-md);
        font-weight: 600;
        cursor: pointer;
        transition: all var(--transition-base);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 1rem;
        position: relative;
        overflow: hidden;
        font-family: inherit;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      .btn:active {
        transform: scale(0.95);
      }

      .btn:hover::before {
        width: 400px;
        height: 400px;
      }

      .btn-primary {
        background: var(--primary-gradient);
        color: white;
        box-shadow: var(--shadow-primary);
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
      }

      .btn-success {
        background: var(--success-gradient);
        color: white;
        box-shadow: var(--shadow-success);
      }

      .btn-success:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
      }

      .btn-danger {
        background: var(--danger-gradient);
        color: white;
        box-shadow: var(--shadow-danger);
      }

      .btn-danger:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
      }

      .btn-warning {
        background: var(--warning-gradient);
        color: white;
        box-shadow: var(--shadow-warning);
      }

      .btn-warning:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
      }

      .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      .btn-xs {
        padding: 0.4rem 0.75rem;
        font-size: 0.75rem;
        border-radius: var(--radius-sm);
        white-space: nowrap;
      }

      /* ============ SEARCH ============ */
      .search-container {
        background: var(--bg-card);
        padding: 1.25rem 1.75rem;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        margin-bottom: 1.5rem;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        align-items: center;
        border: 1px solid var(--border-color);
        transition: all var(--transition-base);
      }

      .search-container:hover {
        box-shadow: var(--shadow-lg);
      }

      .search-input {
        flex: 1;
        min-width: 220px;
        padding: 0.85rem 1.25rem;
        border: 2px solid var(--border-color);
        border-radius: var(--radius-md);
        font-size: 1rem;
        background: var(--bg-light);
        color: var(--text-dark);
        transition: all var(--transition-base);
        font-family: inherit;
      }

      .search-input:hover {
        border-color: var(--primary-light);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        background: var(--bg-white);
      }

      /* ============ TABLE ============ */
      .table-container {
        background: var(--bg-card);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        border: 1px solid var(--border-color);
        transition: all var(--transition-base);
      }

      .table-container:hover {
        box-shadow: var(--shadow-lg);
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: var(--primary-gradient);
        position: relative;
      }

      thead::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.5),
          transparent
        );
      }

      th {
        padding: 1.25rem;
        text-align: left;
        font-weight: 700;
        color: white;
        border-bottom: none;
        text-transform: uppercase;
        font-size: 0.875rem;
        letter-spacing: 0.5px;
      }

      td {
        padding: 1.25rem;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-dark);
        font-weight: 500;
      }

      tbody tr {
        transition: all var(--transition-fast);
        position: relative;
      }

      tbody tr::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 3px;
        background: var(--primary-gradient);
        transform: scaleY(0);
        transition: transform var(--transition-base);
      }

      tbody tr:hover {
        background: linear-gradient(
          90deg,
          rgba(99, 102, 241, 0.05) 0%,
          transparent 100%
        );
        transform: scale(1.01);
      }

      tbody tr:hover::before {
        transform: scaleY(1);
      }

      .actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      /* ============ PAGINATION ============ */
      .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.75rem;
        padding: 1.5rem;
        flex-wrap: wrap;
      }

      .pagination button {
        padding: 0.65rem 1.25rem;
        border: 2px solid var(--border-color);
        background: var(--bg-white);
        color: var(--text-dark);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-base);
        font-weight: 600;
        font-family: inherit;
        min-width: 45px;
      }

      .pagination button:hover:not(:disabled) {
        background: var(--primary-gradient);
        color: white;
        border-color: transparent;
        transform: translateY(-2px) scale(1.05);
        box-shadow: var(--shadow-primary);
      }

      .pagination button:active:not(:disabled) {
        transform: translateY(0) scale(0.98);
      }

      .pagination button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }

      .pagination button.active {
        background: var(--primary-gradient);
        color: white;
        border-color: transparent;
        box-shadow: var(--shadow-primary);
      }

      /* ============ NOTIFICATIONS ============ */
      .notification {
        position: fixed;
        top: 5rem;
        right: 1.5rem;
        padding: 1.25rem 1.75rem;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        z-index: 1000;
        animation: slideInRight 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        gap: 0.75rem;
        max-width: 420px;
        backdrop-filter: blur(20px);
        font-weight: 600;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      @keyframes slideInRight {
        from {
          transform: translateX(400px) scale(0.8);
          opacity: 0;
        }
        to {
          transform: translateX(0) scale(1);
          opacity: 1;
        }
      }

      .notification.success {
        background: var(--success-gradient);
        color: white;
        box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4);
      }

      .notification.error {
        background: var(--danger-gradient);
        color: white;
        box-shadow: 0 10px 40px rgba(239, 68, 68, 0.4);
      }

      /* ============ EDIT MODE ============ */
      .edit-input {
        padding: 0.5rem;
        border: 2px solid var(--primary-color);
        border-radius: var(--radius-sm);
        width: 100%;
        background: var(--bg-light);
        color: var(--text-dark);
        font-weight: 500;
        font-family: inherit;
        transition: all var(--transition-base);
      }

      .edit-input:focus {
        outline: none;
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      }

      /* ============ PRINT INVOICE STYLE ============ */
      @media print {
        body > *:not(.print-invoice-content) {
          display: none !important;
        }
        .print-invoice-content {
          display: block !important;
          width: 100%;
          font-family: "Times New Roman", Times, serif;
          font-size: 11pt;
          margin: 0;
          padding: 30px;
          color: black;
          background-color: white;
          border: none;
        }
        .invoice-header {
          border-bottom: 3px solid #6366f1;
          padding-bottom: 10px;
          margin-bottom: 20px;
          display: flex;
          justify-content: space-between;
          align-items: flex-end;
        }
        .invoice-header h2 {
          color: #6366f1;
          font-size: 20pt;
          margin: 0;
        }
        .company-info {
          text-align: right;
          font-size: 10pt;
        }
        .invoice-details {
          display: flex;
          justify-content: space-between;
          margin-bottom: 20px;
          border: 1px solid #ddd;
          padding: 15px;
          border-radius: 5px;
        }
        .customer-info,
        .order-info {
          width: 48%;
        }
        .invoice-details strong {
          display: inline-block;
          width: 120px;
          color: #2d3748;
        }
        .invoice-items h3 {
          font-size: 14pt;
          border-bottom: 2px solid #e2e8f0;
          padding-bottom: 5px;
          margin-bottom: 10px;
        }
        .invoice-items table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .invoice-items th,
        .invoice-items td {
          border: 1px solid #ddd;
          padding: 12px;
          text-align: left;
        }
        .invoice-items th {
          background-color: #6366f1;
          color: white;
          font-weight: bold;
          font-size: 10pt;
        }
        .invoice-total {
          text-align: right;
          font-size: 14pt;
          font-weight: bold;
          margin-top: 20px;
          padding: 15px;
          background-color: #f8fafc;
          border-radius: 5px;
          border: 1px solid #e2e8f0;
        }
        .invoice-footer {
          text-align: center;
          margin-top: 50px;
          font-style: italic;
          color: #666;
          font-size: 10pt;
        }
        .invoice-signatures {
          display: flex;
          justify-content: space-around;
          margin-top: 60px;
          text-align: center;
        }
        .invoice-signatures div {
          width: 45%;
        }
        .invoice-signatures p {
          font-weight: bold;
          margin-bottom: 5px;
          border-bottom: 1px dashed #aaa;
          display: inline-block;
          padding-bottom: 2px;
        }
      }

      /* ============ LOADING SPINNER ============ */
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      /* ============ PULSE ANIMATION ============ */
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      /* ============ GLOW EFFECT ============ */
      @keyframes glow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }
        50% {
          box-shadow: 0 0 30px rgba(99, 102, 241, 0.6);
        }
      }

      .glow {
        animation: glow 2s ease-in-out infinite;
      }

      /* ============ SCROLL BEHAVIOR ============ */
      html {
        scroll-behavior: smooth;
      }

      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-light);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }

      /* ============ SELECTION ============ */
      ::selection {
        background: rgba(99, 102, 241, 0.2);
        color: var(--text-dark);
      }

      ::-moz-selection {
        background: rgba(99, 102, 241, 0.2);
        color: var(--text-dark);
      }

      /* ============ FOCUS VISIBLE ============ */
      *:focus-visible {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      /* ============ RESPONSIVE ============ */
      @media (max-width: 768px) {
        .header h1 {
          font-size: 1.4rem;
        }
        .header-content {
          padding: 1rem;
        }
        .stats-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }
        .stat-card {
          padding: 1.5rem;
        }
        .stat-value {
          font-size: 2rem;
        }
        .form-grid {
          grid-template-columns: 1fr;
        }
        .form-card,
        .chart-container,
        .table-container {
          padding: 1.5rem;
        }
        table {
          font-size: 0.875rem;
        }
        th,
        td {
          padding: 0.75rem 0.5rem;
        }
        .actions {
          flex-direction: row;
        }
        .btn-xs {
          padding: 0.3rem 0.5rem;
          font-size: 0.7rem;
        }
        .notification {
          right: 1rem;
          left: 1rem;
          max-width: calc(100% - 2rem);
        }
        .chart-header {
          flex-direction: column;
          align-items: flex-start;
        }
        .container {
          padding: 1.5rem 1rem;
        }
        .nav {
          flex-wrap: wrap;
          width: 100%;
        }
        .nav-btn {
          flex: 1;
          min-width: 100px;
          font-size: 0.85rem;
          padding: 0.5rem 0.75rem;
        }
        .pagination {
          gap: 0.5rem;
        }
        .pagination button {
          padding: 0.5rem 0.85rem;
          min-width: 40px;
        }
      }

      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.2rem;
        }
        .stat-value {
          font-size: 1.75rem;
        }
        .chart-header h3,
        .form-card h3 {
          font-size: 1.25rem;
        }
        .btn {
          padding: 0.75rem 1.25rem;
          font-size: 0.9rem;
        }
        .btn-sm {
          padding: 0.4rem 0.75rem;
          font-size: 0.8rem;
        }
      }

      /* ================================================= */
      /* ========== MEDIA QUERY CHO M√ÄN H√åNH L·ªöN >= 1200px (27 inch t·ªëi ∆∞u) ========== */
      /* ================================================= */

      /* 1. TƒÉng Max-Width cho to√†n b·ªô n·ªôi dung */
      .header-content,
      .container {
        /* TƒÉng t·ª´ 1400px l√™n 1800px ƒë·ªÉ l·∫•p ƒë·∫ßy kho·∫£ng tr·ªëng tr√™n m√†n 27 inch */
        max-width: 1800px;
      }

      @media (min-width: 1200px) {
        /* 2. Tinh ch·ªânh Grid cho m√†n h√¨nh L·ªöN (tr√™n 1200px) */
        .stats-grid {
          /* Cho ph√©p hi·ªÉn th·ªã 5 c·ªôt, t·∫≠n d·ª•ng kh√¥ng gian */
          grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        }

        .form-grid {
          /* Cho ph√©p 3 c·ªôt thay v√¨ 2, l√†m form g·ªçn g√†ng h∆°n */
          grid-template-columns: repeat(3, 1fr);
        }

        .stat-card {
          padding: 2rem 2.5rem; /* Padding l·ªõn h∆°n */
        }
      }

      @media (min-width: 1600px) {
        /* 3. Tinh ch·ªânh cho m√†n h√¨nh R·∫§T L·ªöN (tr√™n 1600px) */
        .stats-grid {
          /* TƒÉng minmax ƒë·ªÉ th·∫ª th·ªëng k√™ kh√¥ng qu√° r·ªông */
          grid-template-columns: repeat(4, minmax(350px, 1fr));
          gap: 2rem;
        }

        .chart-container {
          padding: 3rem; /* TƒÉng padding ƒë·ªÉ bi·ªÉu ƒë·ªì n·ªïi b·∫≠t h∆°n */
        }

        .form-card {
          padding: 3rem;
        }

        .nav {
          gap: 1rem;
        }

        .nav-btn {
          padding: 0.8rem 1.75rem;
          font-size: 1rem;
        }

        .header h1 {
          font-size: 2rem;
        }

        /* ƒêi·ªÅu ch·ªânh form th√™m ƒë∆°n h√†ng cho m√†n h√¨nh si√™u r·ªông */
        #orderForm .form-group:nth-child(5) {
          /* ƒê·∫£m b·∫£o Gi√° v√† T·ªïng ti·ªÅn kh√¥ng b·ªã t√°ch kh·ªèi nhau */
          grid-column: span 1;
        }
        #orderForm .form-group:nth-child(6) {
          grid-column: span 1;
        }
      }

      /* Tinh ch·ªânh cho giao di·ªán Qu·∫£n l√Ω ƒê∆°n h√†ng */
      #orders .form-card,
      #orders .bulk-paste-card,
      #orders .search-container,
      #orders .table-container {
        /* TƒÉng kho·∫£ng c√°ch margin-bottom ƒë·ªÉ c√°c ph·∫ßn t·ª≠ c√≥ kh√¥ng gian th·ªü */
        margin-bottom: 2.5rem;
      }

      /* ============ DARK MODE ENHANCEMENTS ============ */
      [data-theme="dark"] .stat-card,
      [data-theme="dark"] .form-card,
      [data-theme="dark"] .chart-container,
      [data-theme="dark"] .table-container,
      [data-theme="dark"] .search-container,
      [data-theme="dark"] .bulk-paste-card {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        border-color: rgba(255, 255, 255, 0.05);
      }

      [data-theme="dark"] .stat-card:hover,
      [data-theme="dark"] .form-card:hover,
      [data-theme="dark"] .chart-container:hover,
      [data-theme="dark"] .table-container:hover,
      [data-theme="dark"] .bulk-paste-card:hover {
        background: linear-gradient(135deg, #334155 0%, #475569 100%);
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      }

      [data-theme="dark"] tbody tr:hover {
        background: linear-gradient(
          90deg,
          rgba(99, 102, 241, 0.1) 0%,
          transparent 100%
        );
      }

      /* ============ UTILITY CLASSES ============ */
      .text-gradient-primary {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .text-gradient-success {
        background: var(--success-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .text-gradient-warning {
        background: var(--warning-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .shadow-glow-primary {
        box-shadow: 0 0 30px rgba(99, 102, 241, 0.5);
      }

      .shadow-glow-success {
        box-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
      }

      .shadow-glow-warning {
        box-shadow: 0 0 30px rgba(245, 158, 11, 0.5);
      }
    </style>
  </head>
  <body>
    <div
      id="loginModal"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(10px);
        transition: opacity 0.3s ease;
      "
    >
      <div
        class="form-card"
        style="
          max-width: 400px;
          width: 90%;
          padding: 2.5rem;
          text-align: center;
          transform: scale(1.05); /* Hi·ªáu ·ª©ng n·ªïi b·∫≠t */
          border: 2px solid var(--primary-color);
          animation: fadeInUp 0.5s ease;
        "
      >
        <h3
          class="text-gradient-primary"
          style="font-size: 2rem; margin-bottom: 2rem"
        >
          üîê ƒêƒÉng Nh·∫≠p H·ªá Th·ªëng
        </h3>
        <form id="loginForm">
          <div class="form-group" style="margin-bottom: 1.5rem">
            <label for="username">T√†i kho·∫£n (Email)</label>
            <input type="email" id="username" required placeholder="username" />
          </div>
          <div class="form-group" style="margin-bottom: 2rem">
            <label for="password">M·∫≠t kh·∫©u</label>
            <input
              type="password"
              id="password"
              required
              placeholder="password"
            />
          </div>
          <button
            type="submit"
            class="btn btn-primary"
            id="loginButton"
            style="width: 100%; padding: 1rem"
          >
            ‚û°Ô∏è ƒêƒÉng Nh·∫≠p
          </button>
          <p
            id="loginError"
            style="
              color: var(--danger-color);
              margin-top: 1rem;
              font-weight: 600;
            "
          ></p>
        </form>
      </div>
    </div>

    <div id="appContent" style="visibility: hidden"></div>
    <header class="header">
      <div class="header-content">
        <h1>üí∞ Qu·∫£n l√Ω Doanh Thu</h1>
        <div class="header-actions">
          <nav class="nav">
            <button class="nav-btn active" data-section="dashboard">
              Dashboard
            </button>
            <button class="nav-btn" data-section="orders">
              Qu·∫£n l√Ω ƒê∆°n h√†ng
            </button>
          </nav>
          <button class="theme-toggle" id="themeToggle">
            <span id="themeIcon">üåô</span>
          </button>
        </div>
      </div>
    </header>

    <div class="container">
      <section id="dashboard" class="section active">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">T·ªïng doanh thu</div>
            <div class="stat-value" id="totalRevenue">0 ƒë</div>
            <div class="stat-change">üìà T·∫•t c·∫£ th·ªùi gian</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Doanh thu h√¥m nay</div>
            <div class="stat-value" id="todayRevenue">0 ƒë</div>
            <div class="stat-change">üìÖ H√¥m nay</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">T·ªïng ƒë∆°n h√†ng</div>
            <div class="stat-value" id="totalOrders">0</div>
            <div class="stat-change">üì¶ T·∫•t c·∫£</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ƒê∆°n h√†ng h√¥m nay</div>
            <div class="stat-value" id="todayOrders">0</div>
            <div class="stat-change">üïí H√¥m nay</div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h3>Bi·ªÉu ƒë·ªì doanh thu</h3>
            <select id="chartPeriod">
              <option value="30days">30 ng√†y g·∫ßn nh·∫•t</option>
              <option value="month">Th√°ng n√†y</option>
              <option value="year">NƒÉm n√†y</option>
            </select>
          </div>
          <canvas id="revenueChart"></canvas>
        </div>
      </section>

      <section id="orders" class="section">
        <div class="bulk-paste-card">
          <h3>üìã D√°n d·ªØ li·ªáu h√†ng lo·∫°t t·ª´ Excel/B·∫£ng (Kh√°ch h√†ng c≈©)</h3>
          <p
            style="
              margin-bottom: 10px;
              color: var(--text-gray);
              font-size: 0.9rem;
            "
          >
            D√°n c√°c c·ªôt sau v√†o √¥ d∆∞·ªõi (m·ªói d√≤ng l√† m·ªôt kh√°ch h√†ng): **T√™n,
            Email, S·ªë ƒëi·ªán tho·∫°i, S·ªë ƒë∆°n h√†ng, T·ªïng chi ti√™u, Ng√†y ƒëƒÉng k√Ω**.
            <span style="font-weight: 600; color: var(--danger-color)"
              >L∆∞u √Ω: B·∫°n ph·∫£i d√°n ƒë√∫ng th·ª© t·ª± c·ªôt, c√°ch nhau b·∫±ng d·∫•u tab ho·∫∑c
              d·∫•u ph·∫©y.</span
            >
          </p>
          <div class="form-group">
            <textarea
              id="bulkDataInput"
              placeholder="D√°n d·ªØ li·ªáu v√†o ƒë√¢y (v√≠ d·ª•: T√™n\tEmail\t...\tNg√†y)"
            ></textarea>
          </div>
          <button id="importBulkBtn" class="btn btn-primary">
            ‚¨ÜÔ∏è Nh·∫≠p d·ªØ li·ªáu h√†ng lo·∫°t
          </button>
        </div>

        <div class="form-card">
          <h3>‚ûï Th√™m ƒë∆°n h√†ng m·ªõi</h3>
          <form id="orderForm">
            <div class="form-grid">
              <div class="form-group">
                <label for="customerName">T√™n kh√°ch h√†ng *</label>
                <input type="text" id="customerName" required />
              </div>
              <div class="form-group">
                <label for="customerEmail">Email kh√°ch h√†ng</label>
                <input type="email" id="customerEmail" />
              </div>
              <div class="form-group">
                <label for="productName">S·∫£n ph·∫©m *</label>
                <input type="text" id="productName" required />
              </div>
              <div class="form-group">
                <label for="quantity">S·ªë l∆∞·ª£ng *</label>
                <input type="number" id="quantity" min="1" required />
              </div>
              <div class="form-group">
                <label for="price">Gi√° (ƒë) *</label>
                <input type="number" id="price" min="0" required />
              </div>
              <div class="form-group">
                <label>T·ªïng ti·ªÅn</label>
                <input
                  type="text"
                  id="totalPrice"
                  readonly
                  style="background: var(--border-color)"
                />
              </div>
            </div>
            <button type="submit" class="btn btn-primary">
              ‚ûï Th√™m ƒë∆°n h√†ng
            </button>
          </form>
        </div>

        <div class="search-container">
          <input
            type="text"
            id="searchInput"
            class="search-input"
            placeholder="üîç T√¨m ki·∫øm theo t√™n kh√°ch, s·∫£n ph·∫©m ho·∫∑c M√£ ƒêH..."
          />
          <button class="btn btn-success" id="exportBtn">üì• Export CSV</button>
        </div>

        <div class="table-container">
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>M√£ ƒêH</th>
                  <th>T√™n kh√°ch h√†ng</th>
                  <th>Email</th>
                  <th>S·∫£n ph·∫©m</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>Gi√° (ƒë)</th>
                  <th>T·ªïng ti·ªÅn</th>
                  <th>Ng√†y</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="ordersTableBody"></tbody>
            </table>
          </div>
          <div class="pagination" id="pagination"></div>
        </div>
      </section>
    </div>

    <div id="notificationContainer"></div>

    <div class="print-invoice-content" style="display: none"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // ================= GLOBAL VARIABLES =================
      const sections = document.querySelectorAll(".section");
      const navBtns = document.querySelectorAll(".nav-btn");
      const ordersTableBody = document.getElementById("ordersTableBody");
      const orderForm = document.getElementById("orderForm");
      const customerNameInput = document.getElementById("customerName");
      const customerEmailInput = document.getElementById("customerEmail");
      const productNameInput = document.getElementById("productName");
      const quantityInput = document.getElementById("quantity");
      const priceInput = document.getElementById("price");
      const totalPriceInput = document.getElementById("totalPrice");
      const searchInput = document.getElementById("searchInput");
      const exportBtn = document.getElementById("exportBtn");
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");

      const totalRevenueEl = document.getElementById("totalRevenue");
      const todayRevenueEl = document.getElementById("todayRevenue");
      const totalOrdersEl = document.getElementById("totalOrders");
      const todayOrdersEl = document.getElementById("todayOrders");

      const printInvoiceContent = document.querySelector(
        ".print-invoice-content"
      );

      // NEW: Bulk Paste Elements
      const bulkDataInput = document.getElementById("bulkDataInput");
      const importBulkBtn = document.getElementById("importBulkBtn");
      const loginModal = document.getElementById("loginModal");
      const loginForm = document.getElementById("loginForm");
      const usernameInput = document.getElementById("username");
      const passwordInput = document.getElementById("password");
      const loginErrorEl = document.getElementById("loginError");
      const appContent = document.getElementById("appContent");

      // Th√¥ng tin ƒëƒÉng nh·∫≠p c·ªë ƒë·ªãnh
      const ADMIN_USER = "admin0112@gmail.com";
      const ADMIN_PASS = "tuan0112";
      const IS_LOGGED_IN_KEY = "isLoggedIn"; // Local Storage Key

      let orders = [];
      let currentPage = 1;
      const rowsPerPage = 5;
      let revenueChart; // Khai b√°o bi·∫øn chart to√†n c·ª•c

      // ================= UTILITY FUNCTIONS =================

      /**
       * ƒê·ªãnh d·∫°ng s·ªë th√†nh ti·ªÅn t·ªá Vi·ªát Nam ƒê·ªìng (VND)
       * @param {number} num
       * @returns {string} Chu·ªói ti·ªÅn t·ªá
       */
      function formatCurrency(num) {
        if (typeof num !== "number" || isNaN(num)) return "0 ƒë";
        // S·ª≠ d·ª•ng Intl.NumberFormat ƒë·ªÉ ƒë·∫£m b·∫£o ƒë·ªãnh d·∫°ng chu·∫©n
        return new Intl.NumberFormat("vi-VN", {
          style: "currency",
          currency: "VND",
          minimumFractionDigits: 0,
        }).format(num);
      }

      /**
       * C·ªë g·∫Øng parse chu·ªói ng√†y th√°ng theo ƒë·ªãnh d·∫°ng D/M/YYYY
       * @param {string} dateStr
       * @returns {Date} ƒê·ªëi t∆∞·ª£ng Date
       */
      function parseDate(dateStr) {
        if (!dateStr) return new Date();

        // Thay th·∫ø c√°c d·∫•u ph√¢n c√°ch ph·ªï bi·∫øn (/, -, .) b·∫±ng / v√† c·∫Øt kho·∫£ng tr·∫Øng
        const cleanStr = dateStr.trim().replace(/[\-\.]/g, "/");
        const parts = cleanStr.split("/");

        if (parts.length === 3) {
          let day = parseInt(parts[0].trim(), 10);
          let month = parseInt(parts[1].trim(), 10);
          let year = parseInt(parts[2].trim(), 10);

          if (year < 100) {
            year = 2000 + year;
          }
          // L∆∞u √Ω: Th√°ng trong Date constructor l√† 0-11
          const parsedDate = new Date(year, month - 1, day);

          // Ki·ªÉm tra t√≠nh h·ª£p l·ªá nghi√™m ng·∫∑t
          if (
            !isNaN(parsedDate.getTime()) &&
            parsedDate.getFullYear() === year &&
            parsedDate.getMonth() === month - 1 &&
            parsedDate.getDate() === day
          ) {
            return parsedDate;
          }
        }
        // Th·ª≠ parse b·∫±ng new Date() cho c√°c ƒë·ªãnh d·∫°ng chu·∫©n kh√°c
        const fallbackDate = new Date(dateStr);
        if (!isNaN(fallbackDate.getTime())) {
          return fallbackDate;
        }

        return new Date(); // M·∫∑c ƒë·ªãnh l√† ng√†y hi·ªán t·∫°i n·∫øu parse th·∫•t b·∫°i
      }

      /**
       * T·∫°o ID ƒë∆°n h√†ng m·ªõi theo ƒë·ªãnh d·∫°ng DHxxx
       * @param {Array} ordersArray - M·∫£ng ƒë∆°n h√†ng hi·ªán t·∫°i
       * @returns {string} ID m·ªõi
       */
      function generateNewOrderId(ordersArray) {
        const maxIdNum = ordersArray.reduce((max, o) => {
          const match = o.id ? String(o.id).match(/DH(\d+)/) : null;
          const num = match ? parseInt(match[1], 10) : 0;
          return num > max ? num : max;
        }, 0);
        return "DH" + String(maxIdNum + 1).padStart(3, "0");
      }

      /**
       * C·∫≠p nh·∫≠t hi·ªÉn th·ªã T·ªïng ti·ªÅn (T·ª± ƒë·ªông)
       */
      function updateTotalPrice() {
        const q = parseFloat(quantityInput.value) || 0;
        const p = parseFloat(priceInput.value) || 0;
        const total = q * p;
        totalPriceInput.value = total > 0 ? formatCurrency(total) : "";
      }
      quantityInput.addEventListener("input", updateTotalPrice);
      priceInput.addEventListener("input", updateTotalPrice);

      /**
       * Hi·ªÉn th·ªã th√¥ng b√°o Toast
       * @param {string} message
       * @param {string} type - success ho·∫∑c error
       */
      function showNotification(message, type = "success") {
        const container = document.getElementById("notificationContainer");
        const notif = document.createElement("div");
        notif.className = `notification ${type}`;
        notif.innerHTML = `${type === "success" ? "‚úÖ" : "‚ùå"} ${message}`; // Th√™m emoji
        container.appendChild(notif);
        setTimeout(() => {
          notif.style.opacity = "0";
          notif.style.transform = "translateX(400px)";
          notif.addEventListener("transitionend", () => notif.remove());
        }, 3000);
      }

      // ================= DATA PERSISTENCE =================

      /**
       * T·∫£i ƒë∆°n h√†ng t·ª´ Local Storage
       */
      function loadOrders() {
        const storedOrders = localStorage.getItem("orders");
        if (storedOrders) {
          // Chuy·ªÉn ƒë·ªïi date string th√†nh Date objects
          orders = JSON.parse(storedOrders).map((o) => ({
            ...o,
            date: new Date(o.date),
          }));
        } else {
          // Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥
          orders = initialOrders.map((o) => ({ ...o, date: new Date(o.date) }));
        }
        // S·∫Øp x·∫øp ƒë∆°n h√†ng theo ng√†y gi·∫£m d·∫ßn
        orders.sort((a, b) => b.date.getTime() - a.date.getTime());
      }

      /**
       * L∆∞u ƒë∆°n h√†ng v√†o Local Storage
       */
      function saveOrders() {
        localStorage.setItem("orders", JSON.stringify(orders));
      }

      // ================= HANDLERS =================

      // Th√™m ƒë∆°n h√†ng th·ªß c√¥ng
      orderForm.addEventListener("submit", (e) => {
        e.preventDefault();

        const newId = generateNewOrderId(orders);
        const order = {
          id: newId,
          customer: customerNameInput.value.trim(),
          email: customerEmailInput.value.trim() || "N/A",
          product: productNameInput.value.trim(),
          quantity: parseInt(quantityInput.value),
          price: parseFloat(priceInput.value),
          date: new Date(),
        };

        orders.unshift(order); // Th√™m v√†o ƒë·∫ßu ƒë·ªÉ hi·ªÉn th·ªã m·ªõi nh·∫•t
        saveOrders();
        showNotification("Th√™m ƒë∆°n h√†ng th√†nh c√¥ng!", "success");
        orderForm.reset();
        totalPriceInput.value = "";
        renderTable();
        updateDashboard();
        updateChart();
      });

      // X·ª≠ l√Ω Import h√†ng lo·∫°t
      importBulkBtn.addEventListener("click", handleBulkImport);

      function handleBulkImport() {
        const rawData = bulkDataInput.value.trim();
        if (!rawData) {
          showNotification("Vui l√≤ng d√°n d·ªØ li·ªáu v√†o √¥ nh·∫≠p li·ªáu.", "error");
          return;
        }

        const lines = rawData.split("\n").filter((line) => line.trim() !== "");
        const newOrders = [];
        let successCount = 0;
        let failCount = 0;

        // S·ª≠ d·ª•ng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√°ch b·∫±ng tab ho·∫∑c d·∫•u ph·∫©y
        const delimiterRegex = /[\t,]/;
        let currentMaxId = orders.reduce((max, o) => {
          const match = o.id ? String(o.id).match(/DH(\d+)/) : null;
          const num = match ? parseInt(match[1], 10) : 0;
          return num > max ? num : max;
        }, 0);

        const REQUIRED_INDEXES = [0, 1, 3, 4, 5];
        for (const line of lines) {
          let values = line
            .split(delimiterRegex)
            .map((v) => v.trim().replace(/"/g, ""));

          // D·ªØ li·ªáu mong ƒë·ª£i: T√™n, Email, Sƒët, S·ªë ƒë∆°n h√†ng, T·ªïng chi ti√™u, Ng√†y ƒëƒÉng k√Ω
          // Ch√∫ng ta c·∫ßn: T√™n (0), Email (1), S·ªë ƒë∆°n h√†ng (3), T·ªïng chi ti√™u (4), Ng√†y ƒëƒÉng k√Ω (5)
          if (values.length < 6) {
            failCount++;
            continue;
          }

          const customerName = values[0];
          const email = values[1];
          const quantityStr = values[3]; // S·ªë l∆∞·ª£ng
          const totalStr = values[4]; // T·ªïng chi ti√™u
          const dateStr = values[5]; // Ng√†y ƒëƒÉng k√Ω

          const quantity = parseInt(quantityStr) || 1;

          // L√†m s·∫°ch chu·ªói ti·ªÅn t·ªá (ch·ªâ gi·ªØ l·∫°i s·ªë)
          const rawTotal = totalStr.replace(/[^0-9]/g, "");
          const totalAmount = parseFloat(rawTotal) || 0;

          const price = quantity > 0 ? totalAmount / quantity : totalAmount;
          const orderDate = parseDate(dateStr);

          if (
            customerName &&
            quantity >= 1 &&
            totalAmount >= 0 &&
            !isNaN(orderDate.getTime())
          ) {
            currentMaxId++;
            const newId = "DH" + String(currentMaxId).padStart(3, "0");

            const newOrder = {
              id: newId,
              customer: customerName,
              email: email || "N/A",
              product: "ƒê∆°n h√†ng c≈©/Bulk", // ƒê·∫∑t t√™n chung cho ƒë∆°n h√†ng nh·∫≠p lo·∫°t
              quantity: quantity,
              price: price,
              date: orderDate,
            };

            newOrders.push(newOrder);
            successCount++;
          } else {
            failCount++;
          }
        }

        if (newOrders.length > 0) {
          orders.push(...newOrders);
          orders.sort((a, b) => b.date.getTime() - a.date.getTime());
          saveOrders();

          showNotification(
            `Nh·∫≠p li·ªáu th√†nh c√¥ng! Th√™m ${newOrders.length} ƒë∆°n h√†ng m·ªõi. (${failCount} l·ªói)`,
            "success"
          );
          bulkDataInput.value = "";
        } else if (failCount > 0) {
          showNotification(
            `Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o ƒë∆∞·ª£c th√™m. Vui l√≤ng ki·ªÉm tra ƒë·ªãnh d·∫°ng d·ªØ li·ªáu (T·ªïng c·ªông ${failCount} l·ªói).`,
            "error"
          );
        } else {
          showNotification(
            "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu h·ª£p l·ªá n√†o ƒë·ªÉ nh·∫≠p.",
            "error"
          );
        }

        renderTable();
        updateDashboard();
        updateChart();
      }

      // ================= TABLE RENDER & PAGINATION =================

      function renderTable() {
        const search = searchInput.value.toLowerCase();
        let filteredOrders = orders.filter(
          (o) =>
            o.customer.toLowerCase().includes(search) ||
            o.product.toLowerCase().includes(search) ||
            o.email.toLowerCase().includes(search) ||
            o.id.toLowerCase().includes(search)
        );

        // ƒê·∫£m b·∫£o kh√¥ng chia cho 0
        const totalPages = Math.ceil(filteredOrders.length / rowsPerPage) || 1;

        if (currentPage > totalPages) currentPage = totalPages;
        if (currentPage < 1) currentPage = 1;

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageOrders = filteredOrders.slice(start, end);

        ordersTableBody.innerHTML = "";
        if (pageOrders.length === 0) {
          ordersTableBody.innerHTML = `<tr><td colspan="9" style="text-align: center; color: var(--text-gray); padding: 20px;">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o.</td></tr>`;
        }

        pageOrders.forEach((order) => {
          const total = order.quantity * order.price;
          const tr = document.createElement("tr");
          tr.innerHTML = `
    <td>${order.id}</td>
    <td>${order.customer}</td>
    <td>${order.email || "N/A"}</td> 
    <td>${order.product}</td>  
    <td>${order.quantity}</td>
    <td>${formatCurrency(order.price)}</td>
    <td>${formatCurrency(total)}</td>
    <td>${order.date.toLocaleDateString()}</td>
    <td class="actions">
        <button class="btn btn-sm btn-warning btn-xs" onclick="editOrder('${
          order.id
        }')">‚úèÔ∏è S·ª≠a</button>
        <button class="btn btn-sm btn-danger btn-xs" onclick="deleteOrder('${
          order.id
        }')">üóëÔ∏è X√≥a</button>
        <button class="btn btn-sm btn-primary btn-xs" onclick="printInvoice('${
          order.id
        }')">üñ®Ô∏è In Hƒê</button>
    </td>
`;
          ordersTableBody.appendChild(tr);
        });

        renderPagination(totalPages);
      }

      searchInput.addEventListener("input", () => {
        currentPage = 1; // Reset v·ªÅ trang 1 khi t√¨m ki·∫øm
        renderTable();
      });

      // Pagination Render
      const paginationEl = document.getElementById("pagination");
      function renderPagination(totalPages) {
        paginationEl.innerHTML = "";
        if (totalPages <= 1) return;

        // N√∫t Previous
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "¬´";
        prevBtn.disabled = currentPage === 1;
        prevBtn.addEventListener("click", () => {
          if (currentPage > 1) {
            currentPage--;
            renderTable();
          }
        });
        paginationEl.appendChild(prevBtn);

        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement("button");
          btn.textContent = i;
          btn.classList.toggle("active", i === currentPage);
          btn.addEventListener("click", () => {
            currentPage = i;
            renderTable();
          });
          paginationEl.appendChild(btn);
        }

        // N√∫t Next
        const nextBtn = document.createElement("button");
        nextBtn.textContent = "¬ª";
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.addEventListener("click", () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
          }
        });
        paginationEl.appendChild(nextBtn);
      }

      // ================= ACTION FUNCTIONS (GLOBAL) =================

      // X√≥a ƒë∆°n h√†ng
      window.deleteOrder = function (id) {
        orders = orders.filter((o) => o.id !== id);
        saveOrders();
        showNotification("X√≥a ƒë∆°n h√†ng th√†nh c√¥ng!", "success");
        renderTable();
        updateDashboard();
        updateChart();
      };

      // Chuy·ªÉn sang ch·∫ø ƒë·ªô S·ª≠a
      window.editOrder = function (id) {
        const order = orders.find((o) => o.id === id);
        if (!order) return;
        const tr = [...ordersTableBody.children].find(
          (r) => r.children[0].textContent === id
        );
        if (!tr) return;
        tr.innerHTML = `
    <td>${order.id}</td>
    <td><input class="edit-input" type="text" value="${order.customer}"></td>
    <td><input class="edit-input" type="email" value="${
      order.email || ""
    }"></td> 
    <td><input class="edit-input" type="text" value="${order.product}"></td> 
    <td><input class="edit-input" type="number" min="1" value="${
      order.quantity
    }"></td>
    <td><input class="edit-input" type="number" min="0" value="${
      order.price
    }"></td>
    <td>${formatCurrency(order.quantity * order.price)}</td>
    <td>${order.date.toLocaleDateString()}</td>
    <td class="actions">
        <button class="btn btn-sm btn-success btn-xs" onclick="saveEdit('${id}', this)">üíæ L∆∞u</button>
        <button class="btn btn-sm btn-danger btn-xs" onclick="renderTable()">‚ùå H·ªßy</button>
    </td>
`;

        // C·∫≠p nh·∫≠t l·∫°i t·ªïng ti·ªÅn khi thay ƒë·ªïi quantity ho·∫∑c price trong ch·∫ø ƒë·ªô edit
        const quantityInputEdit = tr.querySelector(
          'input[type="number"][min="1"]'
        );
        const priceInputEdit = tr.querySelector(
          'input[type="number"][min="0"]'
        );
        const totalCell = tr.children[6];

        function updateEditTotal() {
          const q = parseInt(quantityInputEdit.value) || 0;
          const p = parseFloat(priceInputEdit.value) || 0;
          totalCell.textContent = formatCurrency(q * p);
        }

        quantityInputEdit.addEventListener("input", updateEditTotal);
        priceInputEdit.addEventListener("input", updateEditTotal);
      };

      // L∆∞u ch·ªânh s·ª≠a
      window.saveEdit = function (id, btn) {
        const tr = btn.closest("tr");
        const inputs = tr.querySelectorAll("input");
        const order = orders.find((o) => o.id === id);

        // X·ª≠ l√Ω gi√° tr·ªã nh·∫≠p li·ªáu
        // Inputs index: 0: customer, 1: email, 2: product, 3: quantity, 4: price
        const newQuantity = parseInt(inputs[3].value);
        const newPrice = parseFloat(inputs[4].value);

        // Ki·ªÉm tra t√≠nh h·ª£p l·ªá
        if (
          isNaN(newQuantity) ||
          newQuantity < 1 ||
          isNaN(newPrice) ||
          newPrice < 0
        ) {
          showNotification("L·ªói: S·ªë l∆∞·ª£ng v√† Gi√° ph·∫£i l√† s·ªë h·ª£p l·ªá.", "error");
          return;
        }

        // C·∫≠p nh·∫≠t
        order.customer = inputs[0].value.trim();
        order.email = inputs[1].value.trim();
        order.product = inputs[2].value.trim();
        order.quantity = newQuantity;
        order.price = newPrice;

        saveOrders();
        showNotification("C·∫≠p nh·∫≠t ƒë∆°n h√†ng th√†nh c√¥ng!", "success");
        renderTable();
        updateDashboard();
        updateChart();
      };

      // Xu·∫•t CSV
      exportBtn.addEventListener("click", () => {
        if (orders.length === 0) {
          showNotification("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!", "error");
          return;
        }
        let csv =
          "M√£ ƒêH,T√™n kh√°ch h√†ng,Email,S·∫£n ph·∫©m,S·ªë l∆∞·ª£ng,Gi√°,T·ªïng ti·ªÅn,Ng√†y\n";
        orders.forEach((o) => {
          const total = o.quantity * o.price;
          // S·ª≠ d·ª•ng regex ƒë·ªÉ b·ªçc gi√° tr·ªã c√≥ d·∫•u ph·∫©y b·∫±ng d·∫•u ngo·∫∑c k√©p (CSV standard)
          csv += `${o.id},"${o.customer}","${o.email || ""}","${o.product}",${
            o.quantity
          },${o.price},${total},${o.date.toLocaleDateString("vi-VN")}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "orders_revenue_data.csv";
        a.click();
        URL.revokeObjectURL(url);
        showNotification("Xu·∫•t CSV th√†nh c√¥ng!", "success");
      });

      // In H√≥a ƒë∆°n
      window.printInvoice = function (id) {
        const order = orders.find((o) => o.id === id);
        if (!order) {
          showNotification("Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng!", "error");
          return;
        }

        const total = order.quantity * order.price;

        const invoiceHTML = `
      <div style="max-width: 800px; margin: 0 auto; padding: 40px 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fff;">
          
          <div style="text-align: center; border-bottom: 3px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px;">
              <h1 style="margin: 0; color: #2c3e50; font-size: 32px; font-weight: 700; letter-spacing: 1px;">H√ìA ƒê∆†N B√ÅN H√ÄNG</h1>
              <p style="margin: 8px 0 0 0; color: #7f8c8d; font-size: 14px;">SALES INVOICE</p>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 35px;">
              
              <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 10px; color: white;">
                  <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 600; border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px;">TU·∫§N V√Ä QU√ÇN FPT</h3>
                  <p style="margin: 8px 0; font-size: 14px; line-height: 1.6;">
                      <strong>üìç ƒê·ªãa ch·ªâ:</strong><br>
                      FPT UNIVERSITY
                  </p>
                  <p style="margin: 8px 0; font-size: 14px;">
                      <strong>‚úâÔ∏è Email:</strong> lequan12305@gmail.com
                  </p>
              </div>

              <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border-left: 4px solid #3498db;">
                  <h3 style="margin: 0 0 15px 0; font-size: 18px; font-weight: 600; color: #2c3e50;">TH√îNG TIN KH√ÅCH H√ÄNG</h3>
                  <p style="margin: 8px 0; font-size: 14px; color: #34495e; line-height: 1.6;">
                      <strong>üë§ Kh√°ch h√†ng:</strong> ${order.customer}
                  </p>
                  <p style="margin: 8px 0; font-size: 14px; color: #34495e;">
                      <strong>‚úâÔ∏è Email:</strong> ${order.email || "Kh√¥ng c√≥"}
                  </p>
              </div>
          </div>

          <div style="background: linear-gradient(to right, #f093fb 0%, #f5576c 100%); padding: 20px 25px; border-radius: 10px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
              <div style="color: white;">
                  <strong style="font-size: 14px;">üîñ M√£ ƒë∆°n h√†ng:</strong>
                  <span style="font-size: 18px; font-weight: 600; margin-left: 8px;">#${
                    order.id
                  }</span>
              </div>
              <div style="color: white;">
                  <strong style="font-size: 14px;">üìÖ Ng√†y:</strong>
                  <span style="font-size: 16px; margin-left: 8px;">${order.date.toLocaleDateString(
                    "vi-VN"
                  )}</span>
              </div>
              <div style="color: white;">
                  <strong style="font-size: 14px;">üë®‚Äçüíº Ng∆∞·ªùi b√°n:</strong>
                  <span style="font-size: 16px; margin-left: 8px;">Tu·∫•n v√† Qu√¢n FPT</span>
              </div>
          </div>

          <div style="margin-bottom: 30px;">
              <h3 style="color: #2c3e50; font-size: 20px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #ecf0f1;">üì¶ CHI TI·∫æT ƒê∆†N H√ÄNG</h3>
              
              <table style="width: 100%; border-collapse: collapse; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                  <thead>
                      <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                          <th style="padding: 15px; text-align: center; font-weight: 600; border: none;">STT</th>
                          <th style="padding: 15px; text-align: left; font-weight: 600; border: none;">S·∫£n ph·∫©m</th>
                          <th style="padding: 15px; text-align: center; font-weight: 600; border: none;">S·ªë l∆∞·ª£ng</th>
                          <th style="padding: 15px; text-align: right; font-weight: 600; border: none;">ƒê∆°n gi√°</th>
                          <th style="padding: 15px; text-align: right; font-weight: 600; border: none;">Th√†nh ti·ªÅn</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr style="background: #fff; border-bottom: 1px solid #ecf0f1;">
                          <td style="padding: 15px; text-align: center; color: #34495e;">1</td>
                          <td style="padding: 15px; text-align: left; color: #2c3e50; font-weight: 500;">${
                            order.product
                          }</td>
                          <td style="padding: 15px; text-align: center; color: #34495e;">${
                            order.quantity
                          }</td>
                          <td style="padding: 15px; text-align: right; color: #34495e;">${formatCurrency(
                            order.price
                          )}</td>
                          <td style="padding: 15px; text-align: right; color: #2c3e50; font-weight: 600;">${formatCurrency(
                            total
                          )}</td>
                      </tr>
                  </tbody>
              </table>
          </div>

          <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 25px; border-radius: 10px; text-align: right; margin-bottom: 30px;">
              <div style="color: white; font-size: 16px; margin-bottom: 5px;">T·ªîNG C·ªòNG</div>
              <div style="color: white; font-size: 32px; font-weight: 700; letter-spacing: 1px;">${formatCurrency(
                total
              )}</div>
          </div>

          <div style="text-align: center; padding: 25px; background: #f8f9fa; border-radius: 10px; border-top: 3px solid #3498db;">
              <p style="margin: 0; color: #2c3e50; font-size: 16px; font-weight: 500;">
                  üôè Xin ch√¢n th√†nh c·∫£m ∆°n qu√Ω kh√°ch!
              </p>
              <p style="margin: 10px 0 0 0; color: #7f8c8d; font-size: 14px;">
                  Vui l√≤ng ki·ªÉm tra k·ªπ th√¥ng tin tr∆∞·ªõc khi r·ªùi ƒëi.
              </p>
          </div>

      </div>
`;

        printInvoiceContent.innerHTML = invoiceHTML;
        window.print();
        printInvoiceContent.innerHTML = ""; // X√≥a n·ªôi dung sau khi in
      };

      // ================= DASHBOARD STATS =================

      function updateDashboard() {
        // 1. T·ªïng doanh thu (T·∫•t c·∫£ th·ªùi gian)
        const totalRevenue = orders.reduce(
          (a, o) => a + o.quantity * o.price,
          0
        );
        // S·ª≠ d·ª•ng hi·ªáu ·ª©ng ƒë·∫øm s·ªë (Pulse) khi gi√° tr·ªã thay ƒë·ªïi l·ªõn
        if (totalRevenueEl.textContent !== formatCurrency(totalRevenue)) {
          totalRevenueEl.classList.add("pulse");
          setTimeout(() => totalRevenueEl.classList.remove("pulse"), 2000);
        }
        totalRevenueEl.textContent = formatCurrency(totalRevenue);

        // 2. Doanh thu v√† ƒê∆°n h√†ng h√¥m nay
        const today = new Date().toLocaleDateString();
        const todayOrdersData = orders.filter(
          (o) => o.date.toLocaleDateString() === today
        );
        const todayRevenue = todayOrdersData.reduce(
          (a, o) => a + o.quantity * o.price,
          0
        );
        todayRevenueEl.textContent = formatCurrency(todayRevenue);

        // 3. T·ªïng ƒë∆°n h√†ng
        totalOrdersEl.textContent = orders.length;

        // 4. ƒê∆°n h√†ng h√¥m nay
        todayOrdersEl.textContent = todayOrdersData.length;
      }

      // ================= CHART.JS CONFIG =================

      const ctx = document.getElementById("revenueChart").getContext("2d");

      // H√†m t·∫°o Gradient cho Fill Area
      function getGradient(chart) {
        const { ctx, chartArea } = chart;
        if (!chartArea) {
          return null;
        }
        const gradient = ctx.createLinearGradient(
          0,
          chartArea.bottom,
          0,
          chartArea.top
        );
        gradient.addColorStop(0, "rgba(99, 102, 241, 0.1)");
        gradient.addColorStop(0.5, "rgba(99, 102, 241, 0.5)");
        gradient.addColorStop(1, "rgba(139, 92, 246, 0.8)");
        return gradient;
      }

      // Kh·ªüi t·∫°o Chart
      function initializeChart() {
        // L·∫•y m√†u s·∫Øc m·∫∑c ƒë·ªãnh d·ª±a tr√™n theme hi·ªán t·∫°i
        const isDarkMode =
          document.documentElement.getAttribute("data-theme") === "dark";
        const textColor = isDarkMode ? "#f1f5f9" : "#0f172a";
        const gridColor = isDarkMode
          ? "rgba(255, 255, 255, 0.1)"
          : "rgba(0, 0, 0, 0.1)";
        const tickColor = isDarkMode ? "#cbd5e1" : "#64748b";

        const { labels, data } = getRevenueData("30days");

        revenueChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Doanh thu",
                data: data,
                borderColor: "rgba(139, 92, 246, 1)",
                backgroundColor: (context) => getGradient(context.chart),
                tension: 0.4,
                pointRadius: 5,
                pointHoverRadius: 8,
                fill: true,
                borderWidth: 3,
                pointBackgroundColor: "#fff",
                pointBorderColor: "rgba(139, 92, 246, 1)",
                pointBorderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false, // Gi·ªØ nguy√™n, ƒë√£ fix l·ªói b·∫±ng CSS height
            plugins: {
              legend: {
                display: true,
                labels: {
                  color: textColor,
                },
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    if (label) {
                      label += ": ";
                    }
                    if (context.parsed.y !== null) {
                      label += formatCurrency(context.parsed.y); // S·ª≠ d·ª•ng h√†m ƒë·ªãnh d·∫°ng to√†n c·ª•c
                    }
                    return label;
                  },
                },
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: {
                  color: gridColor,
                  borderColor: "transparent",
                },
                ticks: {
                  color: tickColor,
                  // ƒê·ªãnh d·∫°ng y-axis ticks th√†nh ti·ªÅn t·ªá
                  callback: function (value, index, values) {
                    if (value >= 1000000000) {
                      return (value / 1000000000).toFixed(1) + " T·ª∑ ƒë";
                    }
                    if (value >= 1000000) {
                      return (value / 1000000).toFixed(1) + " Tr ƒë";
                    }
                    return formatCurrency(value);
                  },
                },
              },
              x: {
                grid: {
                  color: gridColor,
                  borderColor: "transparent",
                },
                ticks: {
                  color: tickColor,
                },
              },
            },
          },
        });
      }

      function getRevenueData(period = "30days") {
        let labels = [];
        let data = [];
        const now = new Date();
        const currentYear = now.getFullYear();
        const currentMonth = now.getMonth();

        // H√†m l·∫•y ng√†y chu·∫©n, kh√¥ng b·ªã l·ªách m√∫i gi·ªù
        const getLocalizedDate = (date) => {
          return new Date(
            date.getFullYear(),
            date.getMonth(),
            date.getDate()
          ).toLocaleDateString();
        };

        // Nh√≥m ƒë∆°n h√†ng theo ng√†y ƒë·ªÉ t√≠nh t·ªïng nhanh h∆°n
        const revenueByDay = orders.reduce((acc, o) => {
          const dateKey = getLocalizedDate(o.date);
          acc[dateKey] = (acc[dateKey] || 0) + o.quantity * o.price;
          return acc;
        }, {});

        // Nh√≥m ƒë∆°n h√†ng theo th√°ng
        const revenueByMonth = orders.reduce((acc, o) => {
          const monthKey = `${o.date.getMonth() + 1}/${o.date.getFullYear()}`;
          acc[monthKey] = (acc[monthKey] || 0) + o.quantity * o.price;
          return acc;
        }, {});

        if (period === "30days") {
          for (let i = 29; i >= 0; i--) {
            const d = new Date();
            d.setDate(now.getDate() - i);
            const dayKey = getLocalizedDate(d);
            labels.push(dayKey);
            data.push(revenueByDay[dayKey] || 0);
          }
        } else if (period === "month") {
          const daysInMonth = new Date(
            currentYear,
            currentMonth + 1,
            0
          ).getDate();
          for (let i = 1; i <= daysInMonth; i++) {
            labels.push(i + "/" + (currentMonth + 1));

            const dayToSearch = getLocalizedDate(
              new Date(currentYear, currentMonth, i)
            );

            data.push(revenueByDay[dayToSearch] || 0);
          }
        } else if (period === "year") {
          for (let i = 0; i < 12; i++) {
            labels.push(`Th√°ng ${i + 1}`);
            const monthKey = `${i + 1}/${currentYear}`;
            data.push(revenueByMonth[monthKey] || 0);
          }
        }
        return { labels, data };
      }

      function updateChart() {
        if (!revenueChart) return;

        const period = document.getElementById("chartPeriod").value;
        const { labels, data } = getRevenueData(period);
        revenueChart.data.labels = labels;
        revenueChart.data.datasets[0].data = data;

        // C·∫≠p nh·∫≠t l·∫°i m√†u s·∫Øc v√† gradient khi d·ªØ li·ªáu thay ƒë·ªïi (v√† theme)
        revenueChart.data.datasets[0].backgroundColor = (context) =>
          getGradient(context.chart);

        // C·∫≠p nh·∫≠t l·∫°i m√†u s·∫Øc cho Chart khi ƒë·ªïi theme
        const newIsDarkMode =
          document.documentElement.getAttribute("data-theme") === "dark";
        const newTextColor = newIsDarkMode ? "#f1f5f9" : "#0f172a";
        const newGridColor = newIsDarkMode
          ? "rgba(255, 255, 255, 0.1)"
          : "rgba(0, 0, 0, 0.1)";
        const newTickColor = newIsDarkMode ? "#cbd5e1" : "#64748b";

        revenueChart.options.plugins.legend.labels.color = newTextColor;
        revenueChart.options.scales.y.grid.color = newGridColor;
        revenueChart.options.scales.y.ticks.color = newTickColor;
        revenueChart.options.scales.x.grid.color = newGridColor;
        revenueChart.options.scales.x.ticks.color = newTickColor;

        revenueChart.update();
      }

      document
        .getElementById("chartPeriod")
        .addEventListener("change", updateChart);

      // ================= NAVIGATION & THEME =================

      // Navigation
      navBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
          navBtns.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          const section = btn.dataset.section;
          sections.forEach((s) => s.classList.remove("active"));
          document.getElementById(section).classList.add("active");

          // N·∫øu chuy·ªÉn sang Dashboard, c·∫≠p nh·∫≠t l·∫°i Chart
          if (section === "dashboard") {
            updateChart();
          }
        });
      });

      // Theme Toggle
      themeToggle.addEventListener("click", () => {
        const isDarkMode =
          document.documentElement.getAttribute("data-theme") === "dark";
        if (isDarkMode) {
          document.documentElement.setAttribute("data-theme", "light");
          themeIcon.textContent = "üåô";
        } else {
          document.documentElement.setAttribute("data-theme", "dark");
          themeIcon.textContent = "‚òÄÔ∏è";
        }

        // C·∫≠p nh·∫≠t l·∫°i m√†u s·∫Øc cho Chart khi ƒë·ªïi theme
        if (revenueChart) {
          updateChart(); // G·ªçi updateChart ƒë·ªÉ c·∫≠p nh·∫≠t m√†u s·∫Øc v√† theme
        }
      });

      // ================= AUTHENTICATION LOGIC =================

      /**
       * X·ª≠ l√Ω s·ª± ki·ªán ƒëƒÉng nh·∫≠p
       * @param {Event} e
       */
      function handleLogin(e) {
        e.preventDefault();
        const user = usernameInput.value.trim();
        const pass = passwordInput.value.trim();

        // Hi·ªÉn th·ªã loading/v√¥ hi·ªáu h√≥a n√∫t
        const loginButton = document.getElementById("loginButton");
        const originalText = loginButton.textContent;
        loginButton.disabled = true;
        loginButton.innerHTML = `<span class="loading-spinner"></span> ƒêang x·ª≠ l√Ω...`;

        // Gi·∫£ l·∫≠p ƒë·ªô tr·ªÖ m·∫°ng
        setTimeout(() => {
          if (user === ADMIN_USER && pass === ADMIN_PASS) {
            // ƒêƒÉng nh·∫≠p th√†nh c√¥ng
            localStorage.setItem(IS_LOGGED_IN_KEY, "true");
            loginModal.style.opacity = "0";
            setTimeout(() => {
              loginModal.style.display = "none";
              appContent.style.visibility = "visible"; // Hi·ªán n·ªôi dung ·ª©ng d·ª•ng
              showNotification(
                "ƒêƒÉng nh·∫≠p th√†nh c√¥ng! Ch√†o m·ª´ng tr·ªü l·∫°i.",
                "success"
              );

              // Kh·ªüi t·∫°o ·ª©ng d·ª•ng sau khi ƒëƒÉng nh·∫≠p
              initApp();
            }, 300);
          } else {
            // ƒêƒÉng nh·∫≠p th·∫•t b·∫°i
            loginErrorEl.textContent = "T√†i kho·∫£n ho·∫∑c M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.";
            showNotification("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.", "error");

            // Kh√¥i ph·ª•c n√∫t
            loginButton.disabled = false;
            loginButton.innerHTML = originalText;
          }
        }, 1000); // ƒê·ªô tr·ªÖ 1 gi√¢y ƒë·ªÉ m√¥ ph·ªèng m·∫°ng
      }

      /**
       * Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p khi t·∫£i trang
       */
      function checkLoginStatus() {
        const isLoggedIn = localStorage.getItem(IS_LOGGED_IN_KEY) === "true";
        if (isLoggedIn) {
          loginModal.style.display = "none";
          appContent.style.visibility = "visible";
          initApp(); // Kh·ªüi t·∫°o ·ª©ng d·ª•ng ngay l·∫≠p t·ª©c
        } else {
          loginModal.style.display = "flex";
          appContent.style.visibility = "hidden";
          loginForm.addEventListener("submit", handleLogin);
        }
      }

      // ================= INITIALIZATION (ƒêi·ªÅu ch·ªânh) =================

      // Di chuy·ªÉn to√†n b·ªô logic kh·ªüi t·∫°o v√†o h√†m initApp()
      function initApp() {
        loadOrders(); // T·∫£i d·ªØ li·ªáu t·ª´ Local Storage ho·∫∑c t·∫°o m·∫´u
        initializeChart(); // Kh·ªüi t·∫°o bi·ªÉu ƒë·ªì
        updateDashboard(); // C·∫≠p nh·∫≠t Dashboard
        updateChart(); // C·∫≠p nh·∫≠t d·ªØ li·ªáu l·∫ßn ƒë·∫ßu cho Chart
        renderTable(); // Hi·ªÉn th·ªã b·∫£ng l·∫ßn ƒë·∫ßu
      }

      document.addEventListener("DOMContentLoaded", () => {
        // Thay th·∫ø logic DOMContentLoaded c≈© b·∫±ng checkLoginStatus
        checkLoginStatus();
      });
    </script>
  </body>
</html>
